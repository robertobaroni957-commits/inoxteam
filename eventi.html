<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team INOX - Calendario Eventi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;500;600;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        inox: {
                            dark: '#0d0f11',
                            card: '#1a1d20',
                            orange: '#fc6719',
                            blue: '#048ea0',
                            cyan: '#00f0ff',
                            text: '#f0f0f0',
                            gray: '#888888'
                        }
                    },
                    fontFamily: {
                        display: ['Teko', 'sans-serif'],
                        body: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="sidebar.css?v=1.0"> 

    <style>
        /* Stili Base e Font */
        body {
            background-color: #0d0f11;
            color: #f0f0f0;
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, .inox-font {
            font-family: 'Teko', sans-serif;
            text-transform: uppercase;
        }
        
        /* ===== STILI VIDEO BACKGROUND REINSERITI ===== */
        #background-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            background-size: cover;
            filter: grayscale(80%) brightness(30%);
            opacity: 0.5;
        }
        
        /* Stili Sidebar (Ripristino delle classi che di solito sono in sidebar.css) */
        .sidebar-link {
            padding: 10px 16px;
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #f0f0f0;
            transition: background-color 0.2s;
        }
        .sidebar-link:hover {
            background-color: rgba(252, 103, 25, 0.1);
            color: #fc6719;
        }
        .sidebar-active {
            background-color: #fc6719;
            color: black !important;
            font-weight: 700;
        }
        
        /* Stili aggiuntivi per le card eventi */
        .event-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
        }
        .race-type-tag { 
            padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-right: 8px; text-shadow: 0 1px 1px rgba(0,0,0,0.5); 
        }
        .tag-tour-highlight { background-color: #00f0ff; color: #0d0f11; } 
        .tag-endurance { background-color: #048ea0; color: white; } 
        .tag-short { background-color: #fc6719; color: black; } 
        .tag-tt { background-color: #00f0ff; color: black; } 
        .tag-critical { background-color: #ef4444; color: white; }
    </style>
</head>
<body class="bg-inox-dark text-inox-text font-body">

    <video autoplay muted loop id="background-video">
        <source src="https://www.teaminox.it/wp-content/uploads/2025/11/Presentazione-2025-.mp4" type="video/mp4">
    </video>

    <button id="menu-toggle-mobile" class="lg:hidden fixed top-4 left-4 z-[100] p-2 bg-inox-card rounded-md shadow-2xl border border-gray-700">
        <svg class="w-6 h-6 text-inox-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
    </button>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black opacity-0 transition-opacity duration-300 pointer-events-none z-20 lg:hidden"></div>
    
    <div id="main-layout" class="lg:grid lg:grid-cols-[250px_1fr] relative min-h-screen">
        
        <aside id="sidebar" class="fixed top-0 left-0 h-full w-[250px] bg-inox-dark z-30 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto shadow-2xl lg:shadow-none border-r border-gray-800">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center space-x-2">
                    <img src="https://www.teaminox.it/wp-content/uploads/2023/11/cropped-INOX-semplice-colore-lineare.png" class="h-8" alt="Logo INOX">
                    <span class="text-xl font-bold inox-font text-inox-orange">INOX</span>
                </div>
            </div>

            <div class="p-4 space-y-4">
                
                <div>
                    <h3 class="text-sm text-inox-gray uppercase font-semibold pl-2 pt-2 pb-1 border-b border-gray-800">Area Riservata</h3>
                    <a href="index.html" class="sidebar-link">Login/Accesso</a>
                    <a href="registrazione.html" class="sidebar-link">Registrazione</a>
                    <a href="#" class="sidebar-link">Recupera Password</a>
                </div>

                <div>
                    <h3 class="text-sm text-inox-gray uppercase font-semibold pl-2 pt-2 pb-1 border-b border-gray-800">Team INOX</h3>
                    <a href="home.html" class="sidebar-link">Home Pubblica</a>
                    <a href="chi_siamo.html" class="sidebar-link">Chi Siamo / Filosofia</a>
                    <a href="contatti.html" class="sidebar-link">Contatti</a>
                </div>

                <div>
                    <h3 class="text-sm text-inox-gray uppercase font-semibold pl-2 pt-2 pb-1 border-b border-gray-800">Attivit√† Team</h3>
                    <a href="eventi.html" class="sidebar-link sidebar-active">Calendario Eventi</a> <a href="mwt_page.html" class="sidebar-link">Master Winter Tour</a>
                    <a href="zrl_page.html" class="sidebar-link">ZRL Roster (API)</a>
                </div>

                <div>
                    <h3 class="text-sm text-inox-gray uppercase font-semibold pl-2 pt-2 pb-1 border-b border-gray-800">Risorse</h3>
                    <a href="https://zwiftpower.com/team.php?id=16461" target="_blank" class="sidebar-link">ZwiftPower</a>
                    <a href="https://discord.gg/cpr3rBGaZy" target="_blank" class="sidebar-link">Discord INOX</a>
                    <a href="https://strava.app.link/p2Oj6TaE3Gb" target="_blank" class="sidebar-link">Gruppo Strava</a>
                    <a href="https://www.zwift.com/eu/clubs/cef70cde-9149-43a2-b3ae-187643a44703/home" target="_blank" class="sidebar-link">Club Zwift</a>
                </div>

            </div>
        </aside>

        <div id="main-content" class="min-h-screen lg:overflow-y-auto w-full lg:ml-[250px]"> 
            
            <nav id="top-nav" class="bg-inox-card border-b border-gray-700 shadow-lg sticky top-0 z-20">
                <div class="px-6 py-3 flex justify-between items-center text-sm font-semibold">
                    
                    <button id="menu-toggle" class="text-white p-2 lg:hidden flex items-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                    
                    <div class="hidden lg:flex items-center">
                        <a href="home.html" class="hover:text-inox-orange px-4">Home</a>
                        <a href="chi_siamo.html" class="hover:text-inox-orange px-4">Chi Siamo</a>
                        <a href="eventi.html" class="hover:text-inox-orange px-4 text-inox-orange">Eventi</a>
                        <span class="text-inox-gray px-4">|</span>
                        <a href="#" id="logoutButton" class="text-inox-gray hover:text-inox-orange px-4 cursor-pointer">Logout</a> 
                    </div>
                    
                    <a href="#" class="bg-inox-orange text-black font-bold py-1.5 px-3 rounded-md text-xs transition lg:ml-auto">
                        AREA TECNICA
                    </a>
                </div>
            </nav>

            <main class="p-4 sm:p-8">
                
                <h1 class="text-5xl sm:text-7xl font-extrabold mb-8 text-white inox-font tracking-tight border-b border-gray-700 pb-2">
                    CALENDARIO <span class="text-inox-orange">EVENTI</span>
                </h1>
                
                <section id="links" class="mb-12">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-5 text-white inox-font border-b border-gray-700 pb-2">
                        Link <span class="text-inox-cyan">Cruciali</span>
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <a href="https://zwiftpower.com" target="_blank" class="bg-inox-card p-4 rounded-lg text-center event-card border-b-4 border-inox-orange">
                            <span class="block text-2xl mb-1">üìä</span>
                            <span class="font-semibold text-white">ZWIFT POWER</span>
                            <span class="block text-xs text-inox-gray">Le nostre statistiche</span>
                        </a>
                        <a href="https://discord.com" target="_blank" class="bg-inox-card p-4 rounded-lg text-center event-card border-b-4 border-inox-blue">
                            <span class="block text-2xl mb-1">üí¨</span>
                            <span class="font-semibold text-white">DISCORD</span>
                            <span class="block text-xs text-inox-gray">Comunicazione Live</span>
                        </a>
                        <a href="https://strava.com" target="_blank" class="bg-inox-card p-4 rounded-lg text-center event-card border-b-4 border-inox-orange">
                            <span class="block text-2xl mb-1">üìç</span>
                            <span class="font-semibold text-white">STRAVA</span>
                            <span class="block text-xs text-inox-gray">Condivisione Attivit√†</span>
                        </a>
                        <a href="https://www.teaminox.it/wp-content/uploads/2025/11/Presentazione-2025-.mp4" target="_blank" class="bg-inox-card p-4 rounded-lg text-center event-card border-b-4 border-inox-cyan">
                            <span class="block text-2xl mb-1">‚ñ∂Ô∏è</span>
                            <span class="font-semibold text-white">PRESENTAZIONE 2025</span>
                            <span class="block text-xs text-inox-gray">Guarda il Video</span>
                        </a>
                    </div>
                </section>

                <section id="scoreboard" class="mb-12">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-white inox-font border-b border-gray-700 pb-2">
                        Classifica <span class="text-inox-blue">Riservata</span> (API Test)
                    </h2>
                    
                    <p class="text-sm text-inox-gray mb-4">Questa sezione carica i dati solo se il tuo token JWT √® valido e verificato dal Middleware di Cloudflare.</p>
                    
                    <button id="loadScoresButton" class="bg-inox-blue hover:bg-inox-cyan hover:text-black text-white font-bold py-2 px-4 rounded transition">
                        Carica Punteggi Team
                    </button>
                    
                    <div id="scoresContainer" class="mt-6">
                        <p id="apiStatus" class="text-sm text-red-400"></p>
                    </div>

                    <div id="scoresTable" class="hidden">
                        <table class="min-w-full bg-inox-card rounded-lg shadow-xl mt-4 border border-gray-700">
                            <thead>
                                <tr class="border-b border-gray-700 text-left text-sm text-inox-gray uppercase tracking-wider">
                                    <th class="p-3">Utente</th>
                                    <th class="p-3">Ruolo</th>
                                    <th class="p-3 text-center">Score (Simulato)</th>
                                    <th class="p-3 hidden sm:table-cell">Membro Dal</th>
                                </tr>
                            </thead>
                            <tbody id="scoresBody" class="divide-y divide-gray-800">
                                </tbody>
                        </table>
                    </div>
                </section>

                <section id="races" class="mb-12">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-white inox-font border-b border-gray-700 pb-2">
                        Appuntamenti <span class="text-inox-orange">Settimanali</span>
                    </h2>

                    <div class="space-y-6">
                        
                        <a href="mwt_page.html" class="bg-inox-card p-6 rounded-xl event-card border-l-8 border-inox-orange flex flex-col sm:flex-row justify-between items-start transition hover:scale-[1.01] hover:shadow-xl block">
                            <div>
                                <h3 class="text-3xl sm:text-4xl font-bold text-inox-cyan inox-font mb-2">MASTER WINTER TOUR 2025/26</h3>
                                <p class="text-sm text-gray-300 mb-3 font-semibold">Il tour invernale ufficiale di Team INOX. 18 tappe e classifica generale a punti.</p>
                                <span class="race-type-tag tag-tour-highlight">TOUR UFFICIALE</span>
                                <span class="race-type-tag" style="background-color: #1e40af; color: white;">INIZIO 12 DICEMBRE</span>
                            </div>
                            <div class="text-left sm:text-right mt-4 sm:mt-0">
                                <span class="block text-3xl font-display text-inox-orange font-bold">18 TAPPE</span>
                                <span class="block text-xl font-display text-inox-cyan font-bold">6 SETTIMANE</span>
                                <span class="text-sm text-white hover:text-inox-cyan mt-1 block font-bold">Vai all'Hub Completo &rarr;</span>
                            </div>
                        </a>
                        
                        <div class="bg-inox-card p-6 rounded-xl event-card border-l-8 border-inox-cyan flex flex-col sm:flex-row justify-between items-start">
                            <div>
                                <h3 class="text-3xl font-bold text-white inox-font mb-2">ZWIFT RACING LEAGUE (ZRL)</h3>
                                <p class="text-sm text-gray-400 mb-3">La nostra partecipazione alla lega a squadre pi√π prestigiosa di Zwift. Gara settimanale.</p>
                                <span class="race-type-tag tag-critical">LEGA A SQUADRE</span>
                                <span class="race-type-tag" style="background-color: #048ea0; color: white;">PROSSIMA STAGIONE: GENNAIO</span>
                            </div>
                            <div class="text-left sm:text-right mt-4 sm:mt-0">
                                <span class="block text-3xl font-display text-white font-bold">MARTED√å SERA</span>
                                <a href="#" class="text-sm text-inox-cyan hover:text-white mt-1 block font-semibold">Iscrizione & Regolamento</a>
                            </div>
                        </div>

                        <div class="bg-inox-card p-6 rounded-xl event-card border-l-8 border-inox-blue flex flex-col sm:flex-row justify-between items-start">
                            <div>
                                <h3 class="text-3xl font-bold text-white inox-font mb-2">ENDURANCE CHALLENGE</h3>
                                <p class="text-sm text-gray-400 mb-3">La nostra gara di endurance stagionale. Ogni tappa √® una sfida sulla distanza.</p>
                                <span class="race-type-tag tag-endurance">ENDURANCE</span>
                            </div>
                            <div class="text-left sm:text-right mt-4 sm:mt-0">
                                <span class="block text-3xl font-display text-inox-blue font-bold">LUNED√å / MARTED√å</span>
                                <a href="#" class="text-sm text-inox-orange hover:text-white mt-1 block font-semibold">Dettagli Tappe & Classifiche</a>
                            </div>
                        </div>

                        <div class="bg-inox-card p-6 rounded-xl event-card border-l-8 border-inox-orange flex flex-col sm:flex-row justify-between items-start">
                            <div>
                                <h3 class="text-3xl font-bold text-white inox-font mb-2">TOUR OF DISCOVERY</h3>
                                <p class="text-sm text-gray-400 mb-3">Gare brevi su circuiti pianeggianti o misti per mettere alla prova la velocit√†.</p>
                                <span class="race-type-tag tag-short">SHORT RACE</span>
                            </div>
                            <div class="text-left sm:text-right mt-4 sm:mt-0">
                                <span class="block text-3xl font-display text-inox-orange font-bold">MERCOLED√å / GIOVED√å</span>
                                <a href="#" class="text-sm text-inox-orange hover:text-white mt-1 block font-semibold">Iscriviti su Zwift</a>
                            </div>
                        </div>

                        <div class="bg-inox-card p-6 rounded-xl event-card border-l-8 border-inox-cyan flex flex-col sm:flex-row justify-between items-start">
                            <div>
                                <h3 class="text-3xl font-bold text-white inox-font mb-2">TRILOGY MASTERS LEAGUE</h3>
                                <p class="text-sm text-gray-400 mb-3">La sfida a cronometro del Team INOX. Massima potenza richiesta.</p>
                                <span class="race-type-tag tag-tt">CRONOMETRO (TT)</span>
                            </div>
                            <div class="text-left sm:text-right mt-4 sm:mt-0">
                                <span class="block text-3xl font-display text-inox-cyan font-bold">VENERD√å</span>
                                <a href="#" class="text-sm text-inox-orange hover:text-white mt-1 block font-semibold">Regolamento Completo</a>
                            </div>
                        </div>
                    </div>
                </section>

                <footer class="text-center text-xs text-gray-700 mt-10 border-t border-gray-900 pt-6">
                    &copy; 2025 Team INOX. Tutti i diritti riservati.
                </footer>
            </main>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ===========================================
            // üõë 1. PROTEZIONE PAGINA (AUTORIZZAZIONE JWT) üõë
            // ===========================================
            const token = localStorage.getItem('inox_jwt');

            if (!token) {
                console.warn("Accesso negato: Token JWT mancante.");
                // Reindirizza al login. Il middleware del server bloccher√† anche l'accesso diretto ai file.
                window.location.href = 'index.html?auth_error=missing_token';
                return; // Ferma l'esecuzione dello script se non autorizzato
            }
            
            // Elementi DOM per il caricamento dei punteggi
            const loadScoresButton = document.getElementById('loadScoresButton');
            const apiStatus = document.getElementById('apiStatus');
            const scoresBody = document.getElementById('scoresBody');
            const scoresTable = document.getElementById('scoresTable');
            
            // ===========================================
            // üîë 2. CHIAMATA ALL'API PROTETTA (/api/scores)
            // ===========================================
            const API_URL = '/api/scores';

            const loadScores = async () => {
                apiStatus.textContent = 'Caricamento in corso...';
                scoresBody.innerHTML = '';
                scoresTable.classList.add('hidden');
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'GET',
                        headers: { 
                            'Authorization': `Bearer ${token}` // Invia il JWT nel formato standard
                        },
                    });

                    const data = await response.json();

                    if (response.ok && data.status === 'success') {
                        apiStatus.textContent = `Dati caricati! Autenticato come: ${data.requestedBy} (${data.role})`;
                        apiStatus.classList.remove('text-red-400');
                        apiStatus.classList.add('text-inox-cyan');
                        
                        // Riempie la tabella con i dati
                        data.data.forEach(item => {
                            const row = scoresBody.insertRow();
                            row.classList.add('hover:bg-inox-card/50', 'transition', 'duration-150');
                            
                            row.innerHTML = `
                                <td class="p-3 font-semibold">${item.username}</td>
                                <td class="p-3"><span class="px-2 py-0.5 rounded text-xs font-bold ${item.role === 'admin' ? 'bg-red-800 text-white' : 'bg-inox-blue text-black'}">${item.role.toUpperCase()}</span></td>
                                <td class="p-3 text-center text-lg font-display text-inox-orange">${item.score}</td>
                                <td class="p-3 text-xs text-inox-gray hidden sm:table-cell">${item.memberSince}</td>
                            `;
                        });
                        scoresTable.classList.remove('hidden');

                    } else {
                        // Errore 401/403 (Token scaduto o permessi insufficienti)
                        apiStatus.textContent = `‚ùå Errore API: ${data.message || 'Accesso ai dati negato. Rilogga.'}`;
                        apiStatus.classList.remove('text-inox-cyan');
                        apiStatus.classList.add('text-red-400');
                    }

                } catch (error) {
                    console.error('Errore di rete o API:', error);
                    apiStatus.textContent = '‚ùå Errore di connessione. Impossibile contattare l\'API.';
                    apiStatus.classList.add('text-red-400');
                }
            };
            
            if (loadScoresButton) {
                loadScoresButton.addEventListener('click', loadScores);
            }

            // ===========================================
            // 3. LOGICA LOGOUT
            // ===========================================
            const logoutButton = document.getElementById('logoutButton');

            if (logoutButton) {
                logoutButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('inox_jwt'); 
                    window.location.href = 'index.html?logout=success';
                });
            }


            // ===========================================
            // 4. LOGICA TOGGLE SIDEBAR (Mobile)
            // ===========================================
            const menuToggle = document.getElementById('menu-toggle');
            const menuToggleMobile = document.getElementById('menu-toggle-mobile'); 
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            const toggleSidebar = () => {
                sidebar.classList.toggle('-translate-x-full'); // Corretto per Tailwind
                overlay.classList.toggle('opacity-0');
                overlay.classList.toggle('pointer-events-none');
            };

            const handleToggleClick = (e) => {
                e.preventDefault();
                toggleSidebar();
            };

            if (menuToggle) menuToggle.addEventListener('click', handleToggleClick);
            if (menuToggleMobile) menuToggleMobile.addEventListener('click', handleToggleClick);
            
            if (overlay) {
                overlay.addEventListener('click', () => {
                    if (!sidebar.classList.contains('-translate-x-full')) {
                        toggleSidebar();
                    }
                });
            }
        });
    </script>
    
</body>
</html>